SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE VIEW [dbo].[qAnalisi_Province] AS SELECT  DenominazioneProvincia, SUM(TotImpDir) AS SumTotImpDir, SUM(TotIvaDir) AS SumTotIvaDir, SUM(TotDocDir) AS SumTotDocDir, SUM(TotImpInd) AS SumTotImpInd, SUM(TotIvaInd)  AS SumTotIvaInd, SUM(TotDocInd) AS SumTotDocInd FROM     (SELECT  dbo.Province.DenominazioneProvincia, (CASE CliFor.ProvvigioneDiretta WHEN 1 THEN TotImp * ContributoAnalisi ELSE 0 END) AS TotImpDir,  (CASE CliFor.ProvvigioneDiretta WHEN 1 THEN TotIva * ContributoAnalisi ELSE 0 END) AS TotIvaDir, (CASE CliFor.ProvvigioneDiretta WHEN 1 THEN TotDoc * ContributoAnalisi ELSE 0 END)  AS TotDocDir, (CASE CliFor.ProvvigioneDiretta WHEN 0 THEN TotImp * ContributoAnalisi ELSE 0 END) AS TotImpInd,  (CASE CliFor.ProvvigioneDiretta WHEN 0 THEN TotIva * ContributoAnalisi ELSE 0 END) AS TotIvaInd, (CASE CliFor.ProvvigioneDiretta WHEN 0 THEN TotDoc * ContributoAnalisi ELSE 0 END)  AS TotDocInd FROM     dbo.Documenti INNER JOIN dbo.CliFor ON dbo.Documenti.IDCliFor = dbo.CliFor.ID INNER JOIN dbo.Documenti_Tipi ON dbo.Documenti.IDTipo = dbo.Documenti_Tipi.ID LEFT OUTER JOIN dbo.Province ON dbo.Documenti.Provincia = dbo.Province.SiglaProvincia WHERE  (dbo.CliFor.Sospeso = 0) AND (dbo.CliFor.Cliente = 1) AND  (dbo.Documenti.Data BETWEEN CONVERT(DATETIME, '2008-01-01 00:00:00', 102) AND  CONVERT(DATETIME, '2008-12-31 23:59:59', 102)) AND (dbo.Documenti_Tipi.ContributoAnalisi <> 0)) AS Aus GROUP BY DenominazioneProvincia
GO
