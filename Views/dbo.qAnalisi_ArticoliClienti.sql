SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE VIEW [dbo].[qAnalisi_ArticoliClienti] AS SELECT     SUM(dbo.Documenti_Righe.Qta) AS SumQta, dbo.Documenti_Righe.Codice, dbo.Documenti_Righe.Descrizione1,   SUM(dbo.Documenti_Righe.ImpNetto * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpNetto,   SUM(dbo.Documenti_Righe.ImpSconto * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpSconto,   SUM(dbo.Documenti_Righe.ImpNettoScontato * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpNettoScontato,   SUM(dbo.Documenti_Righe.ImpIva * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpIva,   SUM(dbo.Documenti_Righe.ImpLordo * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpLordo, dbo.CliFor.Cliente, dbo.CliFor.Intestazione,   dbo.Documenti_Righe.IDFamiglia,      (SELECT     TOP (1) Dato        FROM          dbo.CliFor_Riferimenti        WHERE      (IDCliFor = dbo.CliFor.ID) AND (Tipo = 'Telefono')) AS Telefono,      (SELECT     TOP (1) Dato        FROM          dbo.CliFor_Riferimenti AS CliFor_Riferimenti_3        WHERE      (IDCliFor = dbo.CliFor.ID) AND (Tipo = 'Fax')) AS Fax,      (SELECT     TOP (1) Dato        FROM          dbo.CliFor_Riferimenti AS CliFor_Riferimenti_2        WHERE      (IDCliFor = dbo.CliFor.ID) AND (Tipo = 'E-mail')) AS Email,      (SELECT     TOP (1) Dato        FROM          dbo.CliFor_Riferimenti AS CliFor_Riferimenti_1        WHERE      (IDCliFor = dbo.CliFor.ID) AND (Tipo = 'Cellulare')) AS Cellulare, dbo.CliFor.Indirizzo, dbo.CliFor.Cap, dbo.CliFor.Comune, dbo.CliFor.Provincia FROM         dbo.Documenti INNER JOIN  dbo.CliFor ON dbo.Documenti.IDCliFor = dbo.CliFor.ID INNER JOIN  dbo.Documenti_Righe ON dbo.Documenti.ID = dbo.Documenti_Righe.IDDocumento INNER JOIN  dbo.Documenti_Tipi ON dbo.Documenti.IDTipo = dbo.Documenti_Tipi.ID LEFT OUTER JOIN  dbo.CodiciIva ON dbo.Documenti_Righe.CodIva = dbo.CodiciIva.ID WHERE     (dbo.Documenti.Data BETWEEN CONVERT(DATETIME, '2008-01-01 00:00:00', 102) AND CONVERT(DATETIME, '2008-12-31 23:59:59', 102)) AND   (dbo.CodiciIva.ImpEsigibile = 1) AND (dbo.Documenti_Tipi.ContributoAnalisi <> 0) GROUP BY dbo.CliFor.ID, dbo.CliFor.Cliente, dbo.Documenti_Righe.Codice, dbo.Documenti_Righe.Descrizione1, dbo.CliFor.Intestazione, dbo.CliFor.Indirizzo, dbo.CliFor.Cap,   dbo.CliFor.Comune, dbo.CliFor.Provincia, dbo.Documenti_Righe.IDFamiglia
GO
