SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE VIEW [dbo].[qAnalisi_ClientiArticoli] AS SELECT  dbo.CliFor.ProvvigioneDiretta, dbo.CliFor.ProvvigioneIndiretta, dbo.CliFor.Sospeso, dbo.CliFor.Cliente, SUM(dbo.Documenti_Righe.Qta) AS SumQta, dbo.Documenti_Righe.Codice,  dbo.Articoli.Descrizione1, SUM(dbo.Documenti_Righe.ImpNetto * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpNetto,  SUM(dbo.Documenti_Righe.ImpSconto * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpSconto, SUM(dbo.Documenti_Righe.ImpNettoScontato * dbo.Documenti_Tipi.ContributoAnalisi)  AS SumImpNettoScontato, SUM(dbo.Documenti_Righe.ImpIva * dbo.Documenti_Tipi.ContributoAnalisi) AS SumImpIva, SUM(dbo.Documenti_Righe.ImpLordo * dbo.Documenti_Tipi.ContributoAnalisi)  AS SumImpLordo, dbo.CliFor.Intestazione FROM     dbo.Documenti INNER JOIN dbo.CliFor ON dbo.Documenti.IDCliFor = dbo.CliFor.ID INNER JOIN dbo.Documenti_Righe ON dbo.Documenti.ID = dbo.Documenti_Righe.IDDocumento INNER JOIN dbo.Documenti_Tipi ON dbo.Documenti.IDTipo = dbo.Documenti_Tipi.ID INNER JOIN dbo.Articoli ON dbo.Documenti_Righe.IDArticolo = dbo.Articoli.ID LEFT OUTER JOIN dbo.CodiciIva ON dbo.Documenti_Righe.CodIva = dbo.CodiciIva.ID WHERE  (dbo.Documenti.Data BETWEEN CONVERT(DATETIME, '2008-01-01 00:00:00', 102) AND CONVERT(DATETIME, '2008-12-31 23:59:59', 102)) AND (dbo.CodiciIva.ImpEsigibile = 1) AND  (dbo.Documenti_Tipi.ContributoAnalisi <> 0) GROUP BY dbo.CliFor.ProvvigioneDiretta, dbo.CliFor.ProvvigioneIndiretta, dbo.CliFor.Sospeso, dbo.CliFor.Cliente, dbo.Documenti_Righe.Codice, dbo.Articoli.Descrizione1, dbo.CliFor.Intestazione HAVING  (dbo.CliFor.Sospeso = 0) AND (dbo.CliFor.Cliente = 1) AND (SUM(dbo.Documenti_Righe.ImpNetto * dbo.Documenti_Tipi.ContributoAnalisi) > 0)
GO
